<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Scroll</title>
</head>

<body>
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Expedita recusandae, dolor assumenda est commodi,
    repudiandae eum architecto modi, tenetur beatae tempore inventore molestias et aliquid consequatur excepturi sit.
    Exercitationem ullam neque perspiciatis doloremque nulla praesentium tempore dolor ratione voluptates, quidem
    debitis nihil fugit consequatur eaque molestias expedita perferendis! Voluptatem ipsum natus nam dolor dolorum harum
    sint id est quam dicta aliquid repellendus distinctio et temporibus delectus incidunt modi mollitia voluptates quae
    quia eos, aut officiis ad? Ipsum nulla asperiores eligendi fugiat non et voluptas, consectetur quae unde molestiae
    commodi alias consequuntur quibusdam repudiandae quas illo maiores. Iusto animi deserunt dolorem error, rerum minus
    molestiae, dicta nostrum veritatis iste fuga. Animi aperiam unde ex dolorem quas eveniet, nisi non similique,
    tenetur fugit veniam aliquid? Atque a libero laboriosam velit odio, perspiciatis culpa, sapiente reprehenderit
    dolorem ipsum magnam doloremque natus cupiditate neque. Nobis consectetur autem quidem? Iure nisi id ipsam
    blanditiis perspiciatis ab hic pariatur reprehenderit, amet temporibus tempora odio in et labore minus dolor esse,
    tempore soluta maiores molestiae beatae. Corporis, et. Harum quia aliquam amet exercitationem magni nobis
    perspiciatis facilis incidunt numquam, doloribus omnis? Omnis nam repellendus exercitationem asperiores totam iure
    quidem nobis eveniet assumenda iusto fuga pariatur quo at quia quos vel, tenetur rem, odit tempore blanditiis
    voluptatibus iste? Magni beatae quasi eligendi nam sit harum corporis iure labore eveniet repudiandae officiis
    officia aut, dignissimos, amet asperiores deserunt sint nostrum, hic qui. Corporis iusto tempora alias quos earum
    facere beatae enim unde sequi reprehenderit cupiditate consequatur sit veritatis, assumenda impedit officiis dolore
    illum nobis? Minima distinctio quidem, dolor neque repellat earum, esse repellendus assumenda ipsam quod iusto?
    Dicta, quod quam, omnis quas, est doloremque maiores dolore dignissimos possimus nesciunt molestiae neque at.
    Perferendis doloribus tempore natus dicta ipsa. Aspernatur saepe consectetur quas fugiat eos incidunt quaerat
    consequuntur possimus minima, quis quasi quisquam porro neque suscipit dolor nihil natus perferendis quo. Maiores
    perferendis officiis porro dolorum doloremque id obcaecati, quos consequuntur atque ex ducimus, vitae praesentium,
    facere perspiciatis necessitatibus vel rerum. Sapiente dolore consequuntur expedita hic aliquid assumenda nemo
    officiis animi ipsum! Iste architecto ab eaque error! A consectetur, et ad tempora veniam ducimus unde eveniet rem
    est deleniti odio possimus doloremque atque voluptas voluptatem iusto numquam? Ipsum aliquam error consectetur
    cupiditate ducimus illo iste architecto provident quo ratione officia totam accusamus incidunt, voluptas corporis
    consequatur animi eaque eius aliquid nemo? Nesciunt cupiditate amet similique ducimus, numquam corporis quis
    delectus repudiandae pariatur impedit officiis magni blanditiis, minima eligendi consequatur magnam eos laboriosam
    quibusdam mollitia. Cum sunt minus tempore, animi at necessitatibus neque repellat a mollitia incidunt quidem labore
    adipisci quis! Dolores ducimus tempora id libero non iure sint et, natus maxime repudiandae ipsa modi reprehenderit,
    unde rerum fuga necessitatibus nihil nisi, delectus laborum rem iusto? In, consequuntur ipsa. Quos quasi quia ut
    voluptatum praesentium repellendus! In dolore culpa error nulla, commodi temporibus minus nisi cum vel quae cumque
    hic ratione ea. Provident, eveniet. Nihil, ab assumenda! Eveniet doloremque atque, necessitatibus cum sapiente aut
    aliquam repudiandae suscipit maiores cupiditate, error illum quisquam? Placeat quo beatae iure, provident eligendi
    temporibus vel maxime corrupti ratione reprehenderit harum eaque libero voluptas aliquid non pariatur quisquam eius
    quis aut sunt laborum velit tempore necessitatibus accusamus? Delectus id doloremque facilis temporibus, veniam aut
    quas ipsam molestiae similique asperiores, accusantium dolores quia laborum debitis iusto atque perferendis deserunt
    eligendi! Doloremque a veniam nihil facere, enim repellat minima voluptatum, accusamus at aut voluptatem amet alias
    exercitationem in aliquam nemo maxime unde nisi fugit aperiam debitis recusandae libero? Illo voluptates ullam porro
    ad rerum. Tempora dolores repellendus excepturi consequatur optio asperiores animi quasi, vitae mollitia quisquam
    porro dolorum incia
    idunt ab repudiandae non voluptatibus hic, omnis velit placeat autem numquam libero quia provident.
    Quam, voluptate ad? Dicta cum suscipit laudantium totam nam dolore sed sit numquam fugit voluptas perspiciatis
    inventore et minima accusantium maiores reiciendis, veniam repudiandae consequatur quae, aspernatur non! Dolores
    error qui nobis facilis id accusamus, quo asperiores illum quam enim omnis quis doloribus vitae modi accusantium
    magni debitis cumque earum! Aliquid asperiores obcaecati perferendis deserunt reprehenderit, magni excepturi vitae
    voluptates, maxime laboriosam aut iste pariatur optio recusandae consequuntur saepe id dicta, nesciunt consectetur.
    Placeat sequi facilis cum qui accusantium, sapiente rerum illo et corrupti ex id culpa, veniam sit iusto.
    Perspiciatis quas in reiciendis id. Ipsum voluptas, eum quae reiciendis a harum sequi qui aspernatur perspiciatis
    iusto, ut unde explicabo alias numquam vitae. Ab debitis placeat amet maiores voluptatem suscipit nam architecto
    atque! Dignissimos voluptatibus, velit nisi natus voluptatum accusamus, deleniti, soluta eum sapiente asperiores
    labore corrupti eius incidunt obcaecati quos? Ipsa ratione sapiente eum odio in quaerat dicta velit pariatur esse
    est blanditiis ipsam vero, porro obcaecati sit cupiditate, eaque optio dolorem reprehenderit. Doloribus optio itaque
    consequatur et deleniti! Illo alias dignissimos architecto inventore itaque cumque molestias minus maxime totam,
    nihil placeat eveniet, impedit accusamus voluptate esse culpa. Ipsum maxime voluptatum sed voluptas iste omnis,
    aliquam, nisi facere cum praesentium error aliquid. Labore explicabo distinctiodunt ab repudiandae non voluptatibus hic, omnis velit placeat autem numquam libero quia provident.
    Quam, voluptate ad? Dicta cum suscipit laudantium totam nam dolore sed sit numquam fugit voluptas perspiciatis
    inventore et minima accusantium maiores reiciendis, veniam repudiandae consequatur quae, aspernatur non! Dolores
    error qui nobis facilis id accusamus, quo asperiores illum quam enim omnis quis doloribus vitae modi accusantium
    magni debitis cumque earum! Aliquid asperiores obcaecati perferendis deserunt reprehenderit, magni excepturi vitae
    voluptates, maxime laboriosam aut iste pariatur optio recusandae consequuntur saepe id dicta, nesciunt consectetur.
    Placeat sequi facilis cum qui accusantium, sapiente rerum illo et corrupti ex id culpa, veniam sit iusto.
    Perspiciatis quas in reiciendis id. Ipsum voluptas, eum quae reiciendis a harum sequi qui aspernatur perspiciatis
    iusto, ut unde explicabo alias numquam vitae. Ab debitis placeat amet maiores voluptatem suscipit nam architecto
    atque! Dignissimos voluptatibus, velit nisi natus voluptatum accusamus, deleniti, soluta eum sapiente asperiores
    labore corrupti eius incidunt obcaecati quos? Ipsa ratione sapiente eum odio in quaerat dicta velit pariatur esse
    est blanditiis ipsam vero, porro obcaecati sit cupiditate, eaque optio dolorem reprehenderit. Doloribus optio itaque
    consequatur et deleniti! Illo alias dignissimos architecto inventore itaque cumque molestias minus maxime totam,
    nihil placeat eveniet, impedit accusamus voluptate esse culpa. Ipsum maxime voluptatum sed voluptas iste omnis,
    aliquam, nisi facere cum praesentium error aliquid. Labore explicabo distinctio, dolores eos molestiae cupiditate
    aliquam, molestias repellendus libero sed quidem, asperiores corporis perferendis. A laboriosam, maxime optio
    aliquam consequuntur iste magnam voluptate at molestiae harum dolor dicta minus ipsum cum ea saepe nostrum suscipit,
re quo soluta est, incidunt id.
    Dignissimos quis hic enim aliquam harum vitae tenetur ducimus expedita officiis assumenda? Quidem fugiat ipsum,
    dolore sequi eius quis perspiciatis explicabo at ullam deleniti vitae tenetur distinctio ut sapiente architecto
    laudantium atque quas? Molestiae sed sapiente deserunt consequatur, alias minus vitae atque quos laborum. Labore a
    dolor dolorum, quia ipsum nesciunt praesentium, blanditiis quos error quo fugit nam expedita est consequuntur
    mollitia possimus quis ad at illo eaque? Accusamus aut ut sequi facilis dolore consequuntur nemo. Debitis ut,
    reprehenderit harum eveniet enim reiciendis, unde vitae corporis vero aliquam eum rem cum. Maxime ducimus
    necessitatibus praesentium non? Harum expedita optio neque magnam debitis nulla. Tempore provident libero, delectus
    minima obcaecati consequatur id quasi dolore dolorum expedita tempora dolor, doloribus perferendis fugiat corrupti
    ipsum deleniti. Quibusdam ex, doloribus voluptatem modi ipsum velit sunt iste unde nisi, deleniti necessitatibus
    enim beatae!
    <div id="image-container"></div>
    <div id="message"></div>

    <script>
        let pageNumber = 1;
        let allImagesShown = false;
        let isLoading = false;

        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
                loadImages();
            }
        });

        async function fetchData() {
            console.log('fetch req hit!');
            isLoading = true;
            const response = await fetch(`/loadimages?page=${pageNumber}`);
            const data = await response.json();
            isLoading = false;
            console.log(data);
            return data;
        };

        async function appendImages(images) {
            const imageContainer = document.getElementById('image-container');
            images.forEach(image => {
                const imgElement = document.createElement('img');
                imgElement.src = image.srcUrl;
                imgElement.alt = image.alt;
                imgElement.classList.add('image-item');
                imageContainer.appendChild(imgElement);
            });
        };

        function showMessage(message) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = message;
        };

        async function loadImages() {
            if (allImagesShown || isLoading) return;

            const data = await fetchData();
            if (data.message) {
                allImagesShown = true;
                showMessage(data.message);
            } else {
                appendImages(data);
                pageNumber++;
            }
        };


    </script>
</body>

</html>